@using KalanalyzeCode.ConfigurationManager.Entity.Entities

@attribute [Route($$"""{{AppConstants.ProjectManager.Index.Route}}/{Id:guid}""")]

<PageTitle>@($"{AppConstants.ProjectManager.Index.AppTitle} - {_project?.Name}")</PageTitle>

<MudText Typo="Typo.h3">@_project?.Name</MudText>

<MudExpansionPanels>
    <MudExpansionPanel Text="Web Api">
        <MudContainer>
            @if (_project?.ApiKey != Guid.Empty)
            {
                <MudToolBar>
                    <MudText>@_project?.ApiKey</MudText>
                    <MudSpacer/>
                    <MudIconButton Icon="@Icons.Material.Filled.Delete" OnClick="@(async () => await OnApiKeyDelete())"/>
                </MudToolBar>
            }
            else
            {
                <MudIconButton Icon="@Icons.Material.Filled.Add" OnClick="@(async () => await OnApiKeyAddClick())"/>
            }
        </MudContainer>
    </MudExpansionPanel>
</MudExpansionPanels>

<MudDataGrid T="Configuration" ReadOnly="false" ServerData="@(new Func<GridState<Configuration>, Task<GridData<Configuration>>>(ServerReload))"
             CommittedItemChanges="@(async (configuration) => await OnItemChanged(configuration))"
             Bordered="true" EditTrigger="DataGridEditTrigger.Manual" EditMode="DataGridEditMode.Form" @ref="_configurationDataGrid">
    <ToolBarContent>
        <MudTextField T="string" ValueChanged="@(OnSearch)" Placeholder="Search" Adornment="Adornment.Start" Immediate="true"
                      AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0" DebounceInterval="500"/>
    </ToolBarContent>
    <Columns>
        <PropertyColumn Property="x => x.Name" Title="Name"/>
        <PropertyColumn Property="x => x.Value" Title="Value"/>
        <TemplateColumn CellClass="d-flex justify-end">
            <CellTemplate>
                <MudIconButton Size="Size.Small" Icon="@Icons.Material.Outlined.Edit" OnClick="@context.Actions.StartEditingItemAsync"/>
            </CellTemplate>
        </TemplateColumn>
    </Columns>
</MudDataGrid>